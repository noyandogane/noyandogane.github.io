<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perlin Noise Terrain Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden;
        }
        h1 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        canvas {
            border: 1px solid #000;
            background-color: #fff;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 8px 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        label {
            font-size: 12px;
            font-weight: bold;
        }
        input[type="range"] {
            width: 100px;
        }
        .value-display {
            font-size: 12px;
            min-width: 40px;
        }
    </style>
</head>
<body>
    <h1>Perlin Noise Terrain Generator</h1>
    <canvas id="terrainCanvas" width="800" height="400"></canvas>
    <div class="controls">
        <button id="generateBtn">Generate</button>
        <button id="animateBtn">Animate</button>
        <div class="slider-container">
            <label>Scale:</label>
            <input type="range" id="scaleSlider" min="10" max="100" value="50">
            <span class="value-display" id="scaleValue">50</span>
        </div>
        <div class="slider-container">
            <label>Octaves:</label>
            <input type="range" id="octavesSlider" min="1" max="6" value="4">
            <span class="value-display" id="octavesValue">4</span>
        </div>
        <div class="slider-container">
            <label>Persistence:</label>
            <input type="range" id="persistenceSlider" min="10" max="90" value="50">
            <span class="value-display" id="persistenceValue">0.50</span>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('terrainCanvas');
        const ctx = canvas.getContext('2d');
        const generateBtn = document.getElementById('generateBtn');
        const animateBtn = document.getElementById('animateBtn');
        const scaleSlider = document.getElementById('scaleSlider');
        const scaleValue = document.getElementById('scaleValue');
        const octavesSlider = document.getElementById('octavesSlider');
        const octavesValue = document.getElementById('octavesValue');
        const persistenceSlider = document.getElementById('persistenceSlider');
        const persistenceValue = document.getElementById('persistenceValue');

        let scale = 50;
        let octaves = 4;
        let persistence = 0.5;
        let offset = 0;
        let animating = false;
        let permutation = [];

        function initPerlin() {
            permutation = [];
            for (let i = 0; i < 256; i++) {
                permutation[i] = i;
            }
            for (let i = 255; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [permutation[i], permutation[j]] = [permutation[j], permutation[i]];
            }
            permutation = [...permutation, ...permutation];
        }

        function fade(t) {
            return t * t * t * (t * (t * 6 - 15) + 10);
        }

        function lerp(a, b, t) {
            return a + t * (b - a);
        }

        function grad(hash, x, y) {
            const h = hash & 3;
            const u = h < 2 ? x : y;
            const v = h < 2 ? y : x;
            return ((h & 1) === 0 ? u : -u) + ((h & 2) === 0 ? v : -v);
        }

        function perlin(x, y) {
            const X = Math.floor(x) & 255;
            const Y = Math.floor(y) & 255;
            x -= Math.floor(x);
            y -= Math.floor(y);
            const u = fade(x);
            const v = fade(y);
            
            const a = permutation[X] + Y;
            const aa = permutation[a];
            const ab = permutation[a + 1];
            const b = permutation[X + 1] + Y;
            const ba = permutation[b];
            const bb = permutation[b + 1];

            return lerp(
                lerp(grad(permutation[aa], x, y), grad(permutation[ba], x - 1, y), u),
                lerp(grad(permutation[ab], x, y - 1), grad(permutation[bb], x - 1, y - 1), u),
                v
            );
        }

        function octavePerlin(x, y) {
            let total = 0;
            let frequency = 1;
            let amplitude = 1;
            let maxValue = 0;

            for (let i = 0; i < octaves; i++) {
                total += perlin(x * frequency / scale, y * frequency / scale) * amplitude;
                maxValue += amplitude;
                amplitude *= persistence;
                frequency *= 2;
            }

            return total / maxValue;
        }

        function generateTerrain() {
            const imageData = ctx.createImageData(canvas.width, canvas.height);
            const data = imageData.data;

            for (let y = 0; y < canvas.height; y++) {
                for (let x = 0; x < canvas.width; x++) {
                    const noise = octavePerlin(x + offset, y);
                    const value = (noise + 1) / 2;
                    
                    let r, g, b;
                    if (value < 0.3) {
                        r = 0;
                        g = Math.floor(100 + value * 100);
                        b = Math.floor(150 + value * 100);
                    } else if (value < 0.4) {
                        r = Math.floor(194 + (value - 0.3) * 400);
                        g = Math.floor(178 + (value - 0.3) * 300);
                        b = Math.floor(128 + (value - 0.3) * 200);
                    } else if (value < 0.6) {
                        r = Math.floor(34 + value * 100);
                        g = Math.floor(139 + value * 100);
                        b = Math.floor(34 + value * 50);
                    } else if (value < 0.75) {
                        r = Math.floor(139 - (value - 0.6) * 200);
                        g = Math.floor(137 - (value - 0.6) * 200);
                        b = Math.floor(112 - (value - 0.6) * 200);
                    } else {
                        r = 255;
                        g = 255;
                        b = 255;
                    }

                    const index = (y * canvas.width + x) * 4;
                    data[index] = r;
                    data[index + 1] = g;
                    data[index + 2] = b;
                    data[index + 3] = 255;
                }
            }

            ctx.putImageData(imageData, 0, 0);
        }

        function animate() {
            if (!animating) return;
            offset += 2;
            generateTerrain();
            requestAnimationFrame(animate);
        }

        scaleSlider.addEventListener('input', (e) => {
            scale = parseInt(e.target.value);
            scaleValue.textContent = scale;
        });

        octavesSlider.addEventListener('input', (e) => {
            octaves = parseInt(e.target.value);
            octavesValue.textContent = octaves;
        });

        persistenceSlider.addEventListener('input', (e) => {
            persistence = parseInt(e.target.value) / 100;
            persistenceValue.textContent = persistence.toFixed(2);
        });

        generateBtn.addEventListener('click', () => {
            initPerlin();
            offset = 0;
            generateTerrain();
        });

        animateBtn.addEventListener('click', () => {
            animating = !animating;
            animateBtn.textContent = animating ? 'Stop' : 'Animate';
            if (animating) animate();
        });

        initPerlin();
        generateTerrain();
    </script>
</body>
</html>
